<!DOCTYPE html>
<html>

	
	    <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
    <meta content="Installing OpenCV on Ubuntu {works even with Anaconda Python}" name="description">
  
  
    <meta name="keywords" content="python,ubuntu,anaconda,opencv,linux">
  
  <meta name="author" content="rsnk">

  <title>
    
        rsnk|OpenCV Installation in Linux (Anaconda / Default Python) {Updated}
    
  </title>
  <!-- favicon -->
  <link rel="shortcut icon" href="/static/img/favicon.ico">

  <!-- Third-party CSS -->
  <link href="/bower_components/normalize-css/normalize.min.css" rel="stylesheet">
  <link href="/bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="/bower_components/animate.css/animate.min.css" rel="stylesheet">
  <link href="/bower_components/components-font-awesome/css/font-awesome.min.css" rel="stylesheet">
  <link href="/static/font-mfizz/font-mfizz.css" rel="stylesheet">
  <!-- <link href="/bower_components/toastr/toastr.min.css" rel="stylesheet"> -->
  <link href="/bower_components/jquery.gritter/css/jquery.gritter.css" rel="stylesheet">
  <link rel="stylesheet" href="/search/css/cb-search.css">

  <!-- Custom styles for this template -->
  <link href="/static/css/style.min.css" rel="stylesheet">
  <link href="/static/css/pygments.css" rel="stylesheet">

  <!-- Scripts -->
  <script src="/bower_components/jquery/dist/jquery.min.js"></script>
  <script src="/search/js/bootstrap3-typeahead.min.js"></script>

  <!-- cb-search -->
  <script src="/search/js/cb-search.js"></script>
  <script>
    $(function(){
        $("pre").css('display','block');
    });
  </script>
  <!-- Mainly scripts -->
  <script src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
  <script src="/bower_components/metisMenu/dist/metisMenu.min.js"></script>
  <script src="/bower_components/jquery-slimscroll/jquery.slimscroll.min.js"></script>

  <!-- Peity -->
  <script src="/bower_components/peity/jquery.peity.min.js"></script>

  <script src="/bower_components/PACE/pace.min.js"></script>
  <script src="/bower_components/wow/dist/wow.min.js"></script>
  <!-- Custom and plugin javascript -->
  <script src="/static/js/inspinia.js"></script>

  <!-- Rickshaw -->
  <script src="/bower_components/rickshaw/vendor/d3.v3.js"></script>
  <script src="/bower_components/rickshaw/rickshaw.min.js"></script>


  <!-- jPages -->
  <script src="/static/js/jPages.js"></script>
  <script src="/static/js/js.js"></script>
  <script id="dsq-count-scr" src="//jalpc.disqus.com/count.js" async></script>
  <script type="text/javascript">
        $(function(){
          /* initiate the plugin */
          $("div.pag-holder").jPages({
              containerID  : "pag-itemContainer",
              perPage      : 5,  /* num of items per page */
              startPage    : 1,
              startRange   : 1,
              midRange     : 3,
              endRange     : 1
          });
      });
  </script>

<!-- GrowingIO -->


</head>

	


<body id="page-top" class="landing-page">

	
	    <div class="search-tool"
      style="position: fixed; top: 0px ; bottom: 0px; left: 0px; right:  0px; opacity: 0.95; background-color: #111111; z-index: 9999; display: none;">
    <input type="text" class="form-control search-content" id="search-content" style="position: fixed; top: 60px" placeholder="Search Blog">

    <div style="position: fixed; top: 16px; right: 16px; z-index: 9999;">
        <img src="/search/img/cb-close.png" id="close-btn"/>
    </div>
</div>

<div style="position: fixed; right: 16px; bottom: 20px; z-index: 9999;">
    <img src="/search/img/cb-search.png"  id="search-btn"  title="Double click Ctrl"/>
</div>

<div class="navbar-wrapper">
        <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">
                <div class="navbar-header page-scroll">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="/">rsnk</a>
                </div>
                <div id="navbar" class="navbar-collapse collapse">
                    <ul class="nav navbar-nav navbar-right">
                        <li><a class="page-scroll" href="/blog/"></a></li>
                        
                            
                            <li>
                            
                            <a class="page-scroll" href="/blog/">Blog</a></li>
                        
                            
                            <li>
                            
                            <a class="page-scroll" href="/python/">Python</a></li>
                        
                            
                            <li>
                            
                            <a class="page-scroll" href="/linux/">Linux</a></li>
                        
                            
                            <li>
                            
                            <a class="page-scroll" href="/computervision/">Computer Vision</a></li>
                        
                            
                            <li>
                            
                            <a class="page-scroll" href="/numismatics/">Numismatics</a></li>
                        
                            
                            <li>
                            
                            <a class="page-scroll" href="">Life</a></li>
                        
                    </ul>
                </div>
            </div>
        </nav>
</div>
<div id="inSlider" class="carousel carousel-fade" data-ride="carousel">
    <ol class="carousel-indicators">
        <li data-target="#inSlider" data-slide-to="0" class="active"></li>
        <li data-target="#inSlider" data-slide-to="1"></li>
    </ol>
    <div class="carousel-inner" role="listbox">
        <div class="item active">
            <div class="container">
                <div class="carousel-caption">
                </div>
                <div class="carousel-image wow zoomIn">
                    <!-- <img src="static/img/landing/laptop.png" alt="laptop"/> -->
                </div>
            </div>
            <!-- Set background for slide in css -->
            <div class="header-back one"></div>

        </div>
        <div class="item">
            <div class="container">
                <div class="carousel-caption blank">
                </div>
            </div>
            <!-- Set background for slide in css -->
            <div class="header-back two"></div>
        </div>
    </div>
    <a class="left carousel-control" href="#inSlider" role="button" data-slide="prev">
        <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
        <span class="sr-only">Previous</span>
    </a>
    <a class="right carousel-control" href="#inSlider" role="button" data-slide="next">
        <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
        <span class="sr-only">Next</span>
    </a>
</div>

	

    <div class="wrapper wrapper-content  animated fadeInRight article">
    <div class="row">
        <div class="col-lg-10 col-lg-offset-1">
            <div class="ibox">
                <div class="ibox-content">
                    <div class="pull-right">
                    	
                        	<button class="btn btn-white btn-xs" type="button">ComputerVision</button>
                        
                    </div>
                    <div class="text-center article-title">
                    <span class="text-muted"><i class="fa fa-clock-o"></i> 23 Feb 2017</span>
                        <h1>
                            OpenCV Installation in Linux (Anaconda / Default Python) {Updated}
                        </h1>
                    </div>
                    	<p>In my earlier blog posts, I talk about adopting different methods for installing OpenCV if you use Anaconda Python. Well, I was an idiot, because I was just providing a jugaad solution. Turns out you can have a unified solution, and that is exactly what I have done <a href="https://github.com/rsnk96/Ubuntu-Setup-Scripts/blob/master/opencvDirectInstall.sh">here</a>. Use that link if you quickly want to get around knowing how it works, or if you’re simply too lazy.</p>

<p>This blog post explains what I have done to build a unified installation script.</p>

<h2 id="note">NOTE:</h2>

<p>If at any point of time, you are re-building with or without changed cmake parameters, then make sure you remove partial built files</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>sudo rm -rf opencv/build/ opencv/CMakeLists.txt opencv/cmake/
<span class="gp">$ </span><span class="nb">cd </span>opencv
<span class="gp">$ </span>git reset --hard HEAD
<span class="gp">$ </span><span class="nb">cd</span> ..
</code></pre>
</div>

<p><br /></p>

<h2 id="step-1-install-the-dependencies">Step 1: Install the dependencies</h2>

<p>Well, the first step towards having a complete installation is obviously to install the required dependencies. This is exactly what about a third of the code does</p>

<p>It installs libraries that would enable you to harness the full functionality of OpenCV (excluding a few modules in contrib like SFM and Kinect Support).</p>

<p>If Anaconda Python is not installed, then we install numpy, scipy and matplotlib for Python 2 and 3 using the Ubuntu software centre. If it is, then we simply check if they are installed using pip directly</p>

<h2 id="step-2-download-the-opencv-and-opencv-contrib-source-code">Step 2: Download the OpenCV and OpenCV Contrib Source code</h2>

<p>It first checks if the folder already exists (in case you have partially run the script in the past). If not, it firsts changes your git buffer size (as the opencv repo size might be bigger than the default maximum git buffer size), and then clones both the source code repos. In case the folder already exists, it simply updates updates by pulling the latest changes from the repository</p>

<h2 id="step-3-extracting-necessary-python-program-parameters">Step 3: Extracting necessary Python program parameters</h2>

<p>The main cause of conflict / issue when you have Anaconda Python installed is the fact that Anaconda has a malformed MKL library and it’s own versions of lots of other libraries, which the OpenCV cmake detects, and uses to override the default full version of the library that exists in your system. To prevent that, we need to remove Anaconda from the <code class="highlighter-rouge">PATH</code> variable, so that it is not detected at all by CMAKE. However, this would mean that Anaconda Python will also not be detected. Hence, we find the all the Python directories needed by CMAKE before hand, and then remove all traces of Anaconda from the path using</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$PATH</span> | tr <span class="s1">':'</span> <span class="s1">'\n'</span> | grep -v <span class="s2">"conda[2-9]</span><span class="se">\?</span><span class="s2">"</span> | uniq | tr <span class="s1">'\n'</span> <span class="s1">':'</span><span class="k">)</span>
</code></pre>
</div>

<p><strong>NOTE</strong>: If you do not have Anaconda Python, this will still work perfectly alright</p>

<h2 id="step-4-cmake-parameters">Step 4: CMAKE parameters</h2>

<p>We enforce the usage of the default Python by storing the Python paths needed for the installation (before removing Anaconda from the path using the above command) by executing</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="nv">py2Ex</span><span class="o">=</span><span class="sb">`</span>which python2<span class="sb">`</span>
<span class="nv">py2In</span><span class="o">=</span><span class="sb">`</span>python2 -c <span class="s2">"from distutils.sysconfig import get_python_inc; print(get_python_inc())"</span><span class="sb">`</span>
<span class="nv">py2Pack</span><span class="o">=</span><span class="sb">`</span>python2 -c <span class="s2">"from distutils.sysconfig import get_python_lib; print(get_python_lib())"</span><span class="sb">`</span>
<span class="nv">py3Ex</span><span class="o">=</span><span class="sb">`</span>which python3<span class="sb">`</span>
<span class="nv">py3In</span><span class="o">=</span><span class="sb">`</span>python3 -c <span class="s2">"from distutils.sysconfig import get_python_inc; print(get_python_inc())"</span><span class="sb">`</span>
<span class="nv">py3Pack</span><span class="o">=</span><span class="sb">`</span>python3 -c <span class="s2">"from distutils.sysconfig import get_python_lib; print(get_python_lib())"</span><span class="sb">`</span>
</code></pre>
</div>
<p>Of course, Python2 installation will be needed after 2019. We next use these variables to force CMAKE to use these directories only</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code> -DPYTHON2_EXECUTABLE<span class="o">=</span><span class="nv">$py2Ex</span> <span class="se">\</span>
 -DPYTHON2_INCLUDE_DIR<span class="o">=</span><span class="nv">$py2In</span> <span class="se">\</span>
 -DPYTHON2_PACKAGES_PATH<span class="o">=</span><span class="nv">$py2Pack</span> <span class="se">\</span>
 -DPYTHON3_EXECUTABLE<span class="o">=</span><span class="nv">$py3Ex</span> <span class="se">\</span>
 -DPYTHON3_INCLUDE_DIR<span class="o">=</span><span class="nv">$py3In</span> <span class="se">\</span>
 -DPYTHON3_PACKAGES_PATH<span class="o">=</span><span class="nv">$py3Pack</span> <span class="se">\</span>
</code></pre>
</div>

<p>We next enable TBB (Threaded Building blocks, gives higher performance), V4L (Video library) and QT (Better image displayer)</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code> -DWITH_TBB<span class="o">=</span>ON <span class="se">\</span>
 -DWITH_V4L<span class="o">=</span>ON <span class="se">\</span>
 -DWITH_QT<span class="o">=</span>ON <span class="se">\</span>
</code></pre>
</div>

<p>We also explicitly disable CUDA, as compiling OpenCV with CUDA slows down the process significantly</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code> -DWITH_CUDA<span class="o">=</span>OFF <span class="se">\</span>
</code></pre>
</div>

<p>We build TIFF as OpenCV relies on an older version of libtiff, and using the system default libtiff in Ubunttu 14.04+ will throw errors.</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code> -DBUILD_TIFF<span class="o">=</span>ON <span class="se">\</span>
</code></pre>
</div>

<h2 id="step-5">Step 5</h2>
<p>We finally make and install, and the installation should complete. We then re-add Anaconda to the PATH variable.</p>

<p>You can check out and download the whole script <a href="https://github.com/rsnk96/Ubuntu-Setup-Scripts/blob/master/opencvDirectInstall.sh">here</a></p>

                    <hr>
                    <div class="row">
                        <div class="col-md-6">
                                <h5 style="display: inline;">Tags:</h5>
                                
                                    <button class="btn btn-white btn-xs" type="button">ComputerVision</button>
                                
                                    <button class="btn btn-white btn-xs" type="button">OpenCV</button>
                                
                                    <button class="btn btn-white btn-xs" type="button">Python</button>
                                
                                    <button class="btn btn-white btn-xs" type="button">Linux</button>
                                
                                    <button class="btn btn-white btn-xs" type="button">Anaconda</button>
                                
                        </div>
                        <div class="col-md-6">
                            <div class="small text-right">
                                <h5>Stats:</h5>
                                <div> 
                                
                                
                                <i class="fa fa-comments-o"> </i> <span class='disqus-comment-count' data-disqus-url="http://localhost:4000/computervision/2017/02/23/computervision-opencv-full-install.html">0</span> comments
                                
                                </div>
                            </div>
                        </div>
                    </div>
                    <br>
                    <div class="row">
                        <div class="col-lg-12">
                            <!-- donate -->
                            
                            <br>
                            <!-- share -->
                            
                            <br>
                            <!-- comment -->
                            


<div id="disqus_thread"></div>
<script>
/** * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS. * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables */
	/*
	var disqus_config = function () { this.page.url = PAGE_URL;
	// Replace PAGE_URL with your page's canonical URL variable this.page.identifier = PAGE_IDENTIFIER;
	// Replace PAGE_IDENTIFIER with your page's unique identifier variable };
	*/
	(function() { // DON'T EDIT BELOW THIS LINE
			var d = document, s = d.createElement('script');
			s.src = '//rsnk96-github-io.disqus.com/embed.js';
			s.setAttribute('data-timestamp', +new Date());
			(d.head || d.body).appendChild(s);
		})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>


                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

</div>


	
	    <script src="/static/js/scroll.js"></script>

<!-- Baidu analytics -->


<!-- Google analytics -->



  <script type="text/javascript">
    var disqusShortName = "rsnk96-github-io";

    var disqusPublicKey = "QynyAYpVI8Gwndf1jVKujxrZKeiu9N1nl4mlSfrvFifOmusa8O7Ta4zMQuqOyZfl";

    var urlArray = [];
    $('.disqus-comment-count').each(function () {
      var url = $(this).attr('data-disqus-url');
      urlArray.push('link:' + url);
    });
    $.ajax({
      type: 'GET',
      url: "https://disqus.com/api/3.0/threads/set.jsonp",
      data: { api_key: disqusPublicKey, forum : disqusShortName, thread : urlArray },
      cache: false,
      dataType: "jsonp",
      success: function (result) {
        for (var i in result.response) {
          var count = result.response[i].posts;
          if ( count ) {
            $('.disqus-comment-count[data-disqus-url="' + result.response[i].link + '"]').html(count);
          }
        }
      }
    });
</script>




<script async src="/static/js/count_page.js"></script>

	

</body>
</html>